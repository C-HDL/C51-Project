C51 COMPILER V9.01   DS18B20                                                               01/19/2024 15:32:20 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE DS18B20
OBJECT MODULE PLACED IN .\Obj\ds18b20.obj
COMPILER INVOKED BY: E:\keilc51\C51\BIN\C51.EXE APP\ds18b20\ds18b20.c BROWSE INCDIR(.\Public;.\APP\key;.\APP\iic;.\APP\a
                    -t24c02;.\APP\ds18b20;.\APP\ds1302;.\APP\smg;.\APP\ired;.\APP\xpt2046;.\APP\lcd1602) DEBUG OBJECTEXTEND PRINT(.\Obj\ds18b
                    -20.lst) OBJECT(.\Obj\ds18b20.obj)

line level    source

   1          #include "ds18b20.h"
   2          #include "intrins.h"
   3          void ds18b20_reset(void)
   4          {
   5   1              DS18B20_PORT=0;
   6   1              delay(75);
   7   1              DS18B20_PORT=1;
   8   1              delay(2);
   9   1      }
  10          
  11          u8 ds18b20_check(void)
  12          {       u8 time_temp=0;
  13   1              while(DS18B20_PORT&&time_temp<20){
  14   2                        time_temp++;
  15   2                        delay(1);
  16   2                        }
  17   1              if(time_temp>=20) return 1;
  18   1              else time_temp=0;
  19   1              while((!DS18B20_PORT)&&time_temp<20){
  20   2                        time_temp++;
  21   2                        delay(1);
  22   2                        }
  23   1              if(time_temp>=20) return 1;
  24   1              return 0;
  25   1      }
  26          
  27          u8 ds18b20_init(void)
  28          {
  29   1              ds18b20_reset();
  30   1              return ds18b20_check();
  31   1      }
  32          
  33          void ds18b20_write_byte(u8 dat)
  34          {
  35   1              u8 i=0;
  36   1              u8 temp=0;
  37   1              for(i=0;i<8;i++)
  38   1              {
  39   2                      //temp=dat&0x01;
  40   2                      //dat>>=1;
  41   2                      temp=(dat>>i)&0x01;
  42   2                      if(temp){
  43   3                      DS18B20_PORT=0;
  44   3                      _nop_();_nop_();
  45   3                      DS18B20_PORT=1;
  46   3                      delay(6);
  47   3                      }
  48   2                      else{
  49   3                              DS18B20_PORT=0;
  50   3                              delay(6);
  51   3                              DS18B20_PORT=1;
  52   3                              _nop_();_nop_();
  53   3                      }
C51 COMPILER V9.01   DS18B20                                                               01/19/2024 15:32:20 PAGE 2   

  54   2                      
  55   2              }
  56   1      }
  57          
  58          u8 ds18b20_read_bit(void)
  59          {
  60   1              u8 dat=0;
  61   1              DS18B20_PORT=0;
  62   1              _nop_();_nop_();
  63   1              DS18B20_PORT=1; 
  64   1              _nop_();_nop_();
  65   1              if(DS18B20_PORT) dat=1;
  66   1              else dat=0;
  67   1              delay(5);
  68   1              return dat;
  69   1      
  70   1      }
  71          u8 ds18b20_read_byte(void)
  72          {
  73   1              u8 i=0;
  74   1              u8 temp=0;
  75   1              u8 dat=0;
  76   1              for(i=0;i<8;i++)
  77   1              {
  78   2                      temp=ds18b20_read_bit();
  79   2                      dat|=(temp<<i);
  80   2                      //dat>>=1;
  81   2                      //dat|=(temp<<7);
  82   2                      //dat=(temp<<7)|(dat>>1);
  83   2              }
  84   1              return dat;
  85   1      }
  86          
  87          void ds18b20_start(void)
  88          {
  89   1              ds18b20_reset();
  90   1              ds18b20_check();
  91   1              ds18b20_write_byte(0xcc);
  92   1              ds18b20_write_byte(0x44);               
  93   1      }
  94          float ds18b20_read_temperature(void)
  95          {       u8 dath=0;
  96   1              u8 datl=0;
  97   1              u16 value=0;
  98   1              float temp;
  99   1      
 100   1              ds18b20_start();
 101   1              ds18b20_reset();
 102   1              ds18b20_check();
 103   1              ds18b20_write_byte(0xcc);
 104   1              ds18b20_write_byte(0xbe);
 105   1              datl=ds18b20_read_byte();
 106   1              dath=ds18b20_read_byte();
 107   1              value=(dath<<8)+datl;
 108   1      
 109   1              if((value&0xf800)==0xf800)
 110   1              {
 111   2                      value=(~value)+1;
 112   2                      temp=value*(-0.0625);
 113   2              }
 114   1              else{
 115   2                      temp=value*0.0625;
C51 COMPILER V9.01   DS18B20                                                               01/19/2024 15:32:20 PAGE 3   

 116   2              }
 117   1              return temp;
 118   1      }       


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    370    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      14
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
